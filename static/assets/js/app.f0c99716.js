(function(){"use strict";var e={5489:function(e,t,o){var s=o(8649),a=o(4626),n=function(){var e=this,t=e._self._c;return t(a.A,{staticClass:"grey lighten-5",attrs:{fluid:""}},[t("router-view")],1)},r=[],i=o(8655),c={},l=(0,i.A)(c,n,r,!1,null,null,null),u=l.exports,d=o(3043);s.Ay.use(d.A);var g=new d.A({}),m=o(2666),f=o(6062),p=o(9348),w=o(7946),h=o(1732),A=o(9350),v=o(631),b=o(8798),y=o(9113),k=o(8347),_=o(5189),T=function(){var e=this,t=e._self._c;return t(f.A,[t(a.A,[t(A.A,{attrs:{fluid:"","fill-height":""}},[t(b.A,{attrs:{"align-center":"","justify-center":""}},[t(v.A,{attrs:{xs12:"",sm8:"",md4:""}},[t(w.A,{staticClass:"elevation-12"},[t(k.A,{attrs:{dark:"",color:"primary"}},[t(_.sw,[e._v(e._s(e.isRegister?e.stateObj.register.name:e.stateObj.login.name)+" form")])],1),t(h.OQ,[t("form",{ref:"form",on:{submit:function(t){t.preventDefault(),e.isRegister?e.doRegister():e.doLogin()}}},[t(y.A,{attrs:{name:"account",label:"Account",type:"text",placeholder:"account",required:""},model:{value:e.account,callback:function(t){e.account=t},expression:"account"}}),t(y.A,{attrs:{name:"password",label:"Password",type:"password",placeholder:"password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e.isRegister?t(y.A,{attrs:{name:"confirmPassword",label:"Confirm Password",type:"password",placeholder:"cocnfirm password",required:""},model:{value:e.confirmPassword,callback:function(t){e.confirmPassword=t},expression:"confirmPassword"}}):e._e(),t("div",{staticClass:"red--text"},[e._v(" "+e._s(e.errorMessage))]),t(p.A,{staticClass:"mt-4",attrs:{type:"submit",color:"primary",value:"log in"}},[e._v(e._s(e.isRegister?e.stateObj.register.name:e.stateObj.login.name))]),t("div",{staticClass:"grey--text mt-4",on:{click:function(t){e.isRegister=!e.isRegister}}},[e._v(" "+e._s(e.toggleMessage)+" ")])],1)])],1)],1)],1)],1)],1)],1)},j=[],O=o(6389);async function S(e,t){const o="/users/register",s={message:""},a={account:e,password:t},n=await O.A.post(o,a);return 201==n.status?s.message=n.data.message:s.message=n.data.error,s}async function x(e,t){const o={status:1,accessToken:"",refreshToken:"",account:""},s="/users/login",a={account:e,password:t},n=await O.A.post(s,a);return n.status&&(console.log({data:n.data}),o.status=0,o.accessToken=n.data.access_token,o.refreshToken=n.data.refresh_token,o.account=n.data.account,P({isLogin:!0,accessToken:o.accessToken,refreshToken:o.refreshToken,account:n.data.account,lastUpdatedAt:(new Date).getTime()})),o}async function I(e){const t={status:"",account:""},o="/users/auth",s={"Content-Type":"application/json",Authorization:`Bearer ${e}`,Accept:"application/json"},a=await O.A.post(o,null,{headers:s});return a.data?(t.status="jwt verify success",t.account=a.data.account,await P({isLogin:!0,account:t.account,lastAuthAt:(new Date).getTime()})):await P({isLogin:!1,account:""}),t}async function L(){console.log("before logout"),window.localStorage.removeItem("accessToken"),window.localStorage.removeItem("refreshToken"),window.localStorage.removeItem("account"),window.localStorage.removeItem("lastUpdatedAt"),window.localStorage.removeItem("lastAuthAt"),window.localStorage.setItem("isLogin",!1)}function P(e){e.isLogin&&window.localStorage.setItem("isLogin",e.isLogin),e.accessToken&&window.localStorage.setItem("accessToken",e.accessToken),e.refreshToken&&window.localStorage.setItem("refreshToken",e.refreshToken),e.account&&window.localStorage.setItem("account",e.account),e.lastUpdatedAt&&window.localStorage.setItem("lastUpdatedAt",e.lastUpdatedAt),e.lastAuthAt&&window.localStorage.setItem("lastAuthAt",e.lastAuthAt)}O.A.interceptors.response.use(e=>e,e=>{if(e.response){const t=e.response.status,o=e.response.data.error||"An error occurred";e.message=o,e.status=t}return Promise.reject(e)});var R={name:"UserLogin",data(){return{account:"",password:"",confirmPassword:"",isRegister:!1,errorMessage:"",stateObj:{register:{name:"Register",message:"Aleady have an Acoount? login."},login:{name:"Login",message:"Register"}}}},methods:{async doLogin(){const{account:e,password:t}=this;try{const o=await x(e,t);console.log(o),this.$router.replace({name:"dashboard",params:{account:o.account}})}catch(o){console.log(o),this.errorMessage=o.message}},async doRegister(){if(this.password==this.confirmPassword){const{account:t,password:o}=this;try{const e=await S(t,o);console.log(e.message),this.isRegister=!1,this.errorMessage="",this.$refs.form.reset()}catch(e){this.errorMessage=e.message}}else this.errorMessage="password did not match"}},computed:{toggleMessage:function(){return this.isRegister?this.stateObj.register.message:this.stateObj.login.message}}},M=R,C=(0,i.A)(M,T,j,!1,null,null,null),U=C.exports,$=o(6478),D=o(1616),q=o(3945),E=o(2008),Z=o(5375),z=o(2373),B=o(1134),F=o(830),Q=o(2772),G=function(){var e=this,t=e._self._c;return t(f.A,[t(a.A,[t(k.A,{attrs:{color:"primary",dark:"",fixed:""}},[t(_.sw,[e._v("Manage Page")])],1),t(Q.A,{attrs:{permanent:""}},[t(E.A,[t(Z.A,{staticClass:"px-2"},[t(z.A,[t(q.A,{attrs:{src:"https://randomuser.me/api/portraits/women/85.jpg"}})],1)],1),t(Z.A,{attrs:{link:""}},[t(B.pr,[t(B.UZ,{staticClass:"text-h6"},[e._v(" "+e._s(e.username||"Username")+" ")]),t(B.w,{on:{click:e.doLogout}},[e._v("log out")])],1)],1)],1),t($.A),t(E.A,{attrs:{dense:"",nav:""}},e._l(e.items,function(o){return t(Z.A,{key:o.title,attrs:{link:""}},[t(F.A,[t(D.A,[e._v(e._s(o.icon))])],1),t(B.pr,[t(B.UZ,[e._v(e._s(o.title))])],1)],1)}),1)],1)],1)],1)},H=[],J={data(){return{items:[{title:"Dashboard",icon:"mdi-view-dashboard"},{title:"Photos",icon:"mdi-image"},{title:"About",icon:"mdi-help-box"}],username:this.$route.params.account}},methods:{async doLogout(){await L(),console.log("after clear set"),this.$router.replace({name:"login"})}}},K=J,N=(0,i.A)(K,G,H,!1,null,null,null),V=N.exports;s.Ay.use(m.Ay);const W=[{path:"/",name:"login",component:U},{path:"/dashboard",name:"dashboard",component:V,props:{},meta:{needLogin:!0}}],X=new m.Ay({mode:"history",base:"/",routes:W});X.beforeEach(async(e,t,o)=>{const s=window.localStorage.getItem("isLogin"),a=window.localStorage.getItem("accessToken"),n=window.localStorage.getItem("account"),r=window.localStorage.getItem("lastAuthAt"),i=(new Date).getTime();if(console.log({isLogin:s,token:a,from:t}),null!=a&&void 0!=a&&""!=a)if(s)if(i-r<=3e4)"login"==e.name?o({name:"dashboard",params:{account:n}}):o();else{const s=await I(a);console.log({to:e.name,from:t.name,authResult:s}),s.status?"login"==e.name?o({name:"dashboard",params:{account:s.account}}):o():(await L(),o({name:"login"}))}else"login"!=e.name&&o({name:"login"});else o()});var Y=X;s.Ay.config.productionTip=!1,new s.Ay({vuetify:g,router:Y,render:e=>e(u)}).$mount("#app")}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,s,a,n){if(!s){var r=1/0;for(u=0;u<e.length;u++){s=e[u][0],a=e[u][1],n=e[u][2];for(var i=!0,c=0;c<s.length;c++)(!1&n||r>=n)&&Object.keys(o.O).every(function(e){return o.O[e](s[c])})?s.splice(c--,1):(i=!1,n<r&&(r=n));if(i){e.splice(u--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[s,a,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,n,r=s[0],i=s[1],c=s[2],l=0;if(r.some(function(t){return 0!==e[t]})){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(c)var u=c(o)}for(t&&t(s);l<r.length;l++)n=r[l],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(u)},s=self["webpackChunkunipile_web_app"]=self["webpackChunkunipile_web_app"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[504],function(){return o(5489)});s=o.O(s)})();
//# sourceMappingURL=app.f0c99716.js.map